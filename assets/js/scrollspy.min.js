/*!
 * Scrollspy Plugin
 * Author: r3plica
 * Licensed under the MIT license
 */
;
(function ($, window, document, undefined) {
	$.fn.extend({
		scrollspy: function (options) {
			var defaults     =     {
				namespace: 'scrollspy', activeClass: 'active', animate: false, duration: 1000, offset: 0, container: window, replaceState: false };
			options     =     $.extend({
			}
				, defaults, options);
			var add     =     function (ex1, ex2) {
				return parseInt(ex1, 10) + parseInt(ex2, 10);
			};
			var findElements     =     function (links) {
				var elements     =     [];
				for (var i     =     0;
					i < links.length;
					i++) {
					var link     =     links[i];
					var hash     =     $(link).attr("href");
					var element     =     $(hash);
					if (element.length > 0) {
						var top     =     Math.floor(element.offset().top), bottom     =     top + Math.floor(element.outerHeight());
						elements.push({
							element: element, hash: hash, top: top, bottom: bottom }
						);
					}
				}
				return elements;
			};
			var findLink     =     function (links, hash) {
				for (var i     =     0;
					i < links.length;
					i++) {
					var link     =     $(links[i]);
					if (link.attr("href")     ===     hash) {
						return link;
					}
				}
			};
			var resetClasses     =     function (links) {
				for (var i     =     0;
					i < links.length;
					i++) {
					var link     =     $(links[i]);
					link.parent().removeClass(options.activeClass);
				}
			};
			var scrollArea     =     '';
			return this.each(function () {
				var element     =     this, container     =     $(options.container);
				var links     =     $(element).find('a');
				for (var i     =     0;
					i < links.length;
					i++) {
					var link     =     links[i];
					$(link).on("click", function (e) {
						var target     =     $(this).attr("href"), $target     =     $(target);
						if ($target.length > 0) {
							var top     =     add($target.offset().top, -200);
							if (options.animate) {
								$('html, body').animate({
									scrollTop: top }
									, options.duration, function() {
										var $target  =  $(target);
										$target.focus();
										if ($target.is(":focus")) {
											return false;
										}
										else {
											$target.attr('tabindex','-1');
											$target.focus();
										};
									}
								);
							}
							else {
								window.scrollTo({top: top, behavior: "smooth"});
							}
							e.preventDefault();
						}
					}
					);
				}
				resetClasses(links);
				var elements     =     findElements(links);
				var trackChanged     =     function() {
					var position     =     {
						top: add($(this).scrollTop(), Math.abs(options.offset)), left: $(this).scrollLeft() };
					var link;
					for (var i     =     1;
						i <=     elements.length;
						i++) {
						var current     =     elements[i];
						if (i     ==     elements.length     ||     position.top < current.top) {
							current     =     elements[i - 1];
							var hash     =     current.hash;
							link     =     findLink(links, hash);
							if (link) {
								if (link.parent().hasClass(options.activeClass)) {
									break;
								}
								if (options.onChange     &&     (scrollArea !==     hash)) {
									options.onChange(current.element, $(element), position);
									scrollArea     =     hash;
								}
								if (options.replaceState) {
									history.replaceState( {
									}
										, '', '/' + hash ) }
								resetClasses(links);
								link.parent().addClass(options.activeClass);
								break;
							}
						}
					}
					if (!link     &&     (scrollArea !==     'exit')     &&     options.onExit) {
						options.onExit($(element), position);
						resetClasses(links);
						scrollArea     =     'exit';
						if (options.replaceState) {
							history.replaceState( {
							}
								, '', '/' ) }
					}
				};
				container.bind('scroll.' + options.namespace, function () {
					trackChanged();
				}
				);
				$( document ).ready(function (e) {
					trackChanged();
				}
				) }
			);
		}
	}
	);
}
)(jQuery, window, document, undefined);
$( document ).ready(function() {
	if ( $("#nav").length ) {
		$("#nav").scrollspy({
			offset: 400, animate: false}
		);
	}
}
);
